query GetUserByEmail($email: String!) {
  user(where: { email: { _eq: $email } }) {
    id
    name
    email
    phone
    user_type
    balance
    corpus_share
    created_at
    kyc_approved
    demographic_info
    loan_requests {
      confirmation_date
      payback_status
      purpose
      risk_calc_result
      status
      created_at
      amount
      purpose
      supporters {
        pledge_amount
        status
      }
    }
    pledge_requests: supporters(where: { status: { _eq: "unknown" } }) {
      ...pledgeFields
    }
    pledges: supporters(where: { status: { _eq: "confirmed" } }) {
      ...pledgeFields
    }
  }
}

fragment pledgeFields on supporters {
  request_id
  pledge_amount
  participation_request_time
  loan_request {
    purpose
    amount
    status
    user {
      email
      name
    }
    risk_calc_result
  }
}
