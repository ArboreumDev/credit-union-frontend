query GetUserByEmail($email: String!) {
  user(where: { email: { _eq: $email } }) {
    id
    name
    email
    phone
    user_type
    balance
    corpus_share
    created_at
    kyc_approved
    demographic_info
    onboarded
    roi
    loan_requests {
      request_id
      confirmation_date
      payback_status
      purpose
      risk_calc_result
      balance
      loan
      status
      created_at
      amount
      purpose
      supporters {
        pledge_amount
        status
        user {
          id
          name
          email
        }
      }
    }
    pledge_requests: supporters(where: { status: { _eq: "unknown" } }) {
      ...pledgeFields
    }
    pledges: supporters(where: { status: { _eq: "confirmed" } }) {
      ...pledgeFields
    }
    active_loans: loan_participants(where: { loan_request: { status: {_eq: "live" } } }) {
      loan_id
      lender_amount
    }
  }
}

fragment pledgeFields on supporters {
  request_id
  pledge_amount
  participation_request_time
  loan_request {
    purpose
    amount
    status
    user {
      email
      name
    }
    risk_calc_result
  }
}
