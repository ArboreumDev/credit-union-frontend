mutation RegisterRepayment (
  $loanId: uuid!, 
  $repayment: repayment_insert_input!, 
  $newLoanState: loan_state_enum,
  $newPrincipalRemaining: float8, 
  $newPrincipalOverdue: float8, 
  $newInterestAccrued: float8, 
  $newInterestPaid: float8, 
  $newNextPaymentAmount: float8, 
  $newNextPaymentDueDate: timestamptz, 
  $updateLog: update_log_insert_input!
) {
  loan: update_loan_by_pk(
    pk_columns: {loan_id: $loanId}
    _set: {
      state: $newLoanState
      principal_remaining: $newPrincipalRemaining
      principal_overdue: $newPrincipalOverdue
      interest_accrued: $newInterestAccrued
      interest_paid: $newInterestPaid
      next_payment_amount: $newNextPaymentAmount
      next_payment_due_date: $newNextPaymentDueDate
    }
  ) {
    state
    principal_remaining
  }
  repayment: insert_repayment_one(object: $repayment) {
    repayment_id
    loan_id
    repaid_principal
    algorand_tx_id
  }
  updateLogEntry: insert_update_log_one(object: $updateLog) {
    update_id
  }
}